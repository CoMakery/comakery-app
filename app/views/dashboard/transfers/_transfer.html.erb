<% transfer = transfer.decorate %>
<% t_type = transfer_type(transfer.transfer_type_id) %>

<div class="transfers-table__transfer" style="border-left-color: <%= @transfers_chart_colors_objects[t_type] %>">
  <%= turbo_stream_from transfer, :updates %>

  <div class="transfers-table__transfer__name">
    <h3>
      <%= link_to transfer.name, project_award_type_award_path(transfer.project, transfer.award_type, transfer) %>
    </h3>

    <div class="transfers-table__transfer__name__type">
      <%= t_type.name %>
    </div>
  </div>

  <div class="transfers-table__transfer__account">
    <label>account</label>

    <% if transfer.account %>
      <% sender_wallet_address = nil %>
      <% sender_wallet_url = nil %>
      <% if transfer.paid? %>
        <% sender_wallet_address = transfer.blockchain_transactions.succeed.last&.source %>
        <% sender_wallet_url = sender_wallet_address && transfer.token ? transfer.token.blockchain.url_for_address_human(sender_wallet_address) : nil %>
      <% end %>
      <%= render partial: "account", locals: {account: transfer.account, wallet: sender_wallet_address, wallet_url: sender_wallet_url} %>
    <% elsif transfer.email %>
      <%= transfer.email %>
    <% else %>
      –
    <% end %>
  </div>

  <div class="transfers-table__transfer__issuer">
    <label>admin</label>

    <% if transfer.paid? %>
      <% sender_wallet_address = transfer.blockchain_transactions.succeed.last&.source %>
      <% sender_wallet_url = sender_wallet_address && transfer.token ? transfer.token.blockchain.url_for_address_human(sender_wallet_address) : nil %>
      <%= render partial: "issuer", locals: {issuer: transfer.issuer, wallet: sender_wallet_address, wallet_url: sender_wallet_url} %>
    <% else %>
      –
    <% end %>
  </div>

  <div class="transfers-table__transfer__total_amount">
    <label>total amount</label>

    <%= transfer.total_amount_pretty %>
  </div>

  <div class="transfers-table__transfer__verification">
    <label>verification</label>

    <div class="account-preview__info__verification">
      <% account = transfer.account.decorate %>
      <%= image_pack_tag "media/src/images/styleguide/icons/verification-#{account.verification_state}.svg", size: "15x15" %>
      <%= account.verification_state&.capitalize %>
    </div>
  </div>

  <div class="transfers-table__transfer__status">
    <label>status</label>

    <% if @project.token %>
    <% if transfer.project.token&._token_type? %>
    <% if current_account&.decorate&.can_send_awards?(transfer.project) %>
      <% if transfer.token&.blockchain&.supported_by_ore_id? && current_account&.ore_id_account.nil? %>
        <div class="transfer-button">
          <%= link_to 'link OREID', wallets_path %>
        </div>
      <% else %>
        <%= render partial: "shared/transfer_button_admin", locals: { transfer: transfer } %>
      <% end %>
    <% else %>
      <% if transfer.recipient_address.blank? && current_account == transfer.account %>
        <div class="transfer-button">
          <%= link_to 'set wallet', wallets_path %>
        </div>
      <% else %>
        <%= render partial: "shared/transfer_button_public", locals: { transfer: transfer } %>
      <% end %>
    <% end %>
  <% end %>

      <% if current_account&.decorate&.can_send_awards?(@project) && transfer.accepted? && !@project.hot_wallet_disabled? && @project.hot_wallet %>
        <div class="transfers-table__transfer__button__history">
          <%= link_to prioritize_project_dashboard_transfer_path(project_id: @project.id, id: transfer.id), class: 'transfer-algo-btn', rel: 'nofollow', method: :patch, data: {turbo: "false"} do %>
            <% if @project.hot_wallet_auto_sending? %>
              <span>PRIORITIZE</span>
            <% elsif @project.hot_wallet_manual_sending? %>
              <span>PAY BY HOT WALLET</span>
            <% end %>
          <% end %>
        </div>
      <% end %>
    <% else %>
      –
    <% end %>
  </div>

  <div class="transfers-table__transfer__history">
    <label>history</label>

    <% if @project.token %>
      <% if transfer.blockchain_transactions.size > 0 %>
        <%= link_to "#{transfer.blockchain_transactions.size} Tx ➔", project_dashboard_transfer_path(transfer.project, transfer), class: 'transfers-table__transfer__button__history' %>
      <% end %>

      <% if policy(transfer).cancel? && transfer.cancelable? %>
        <%= link_to "Cancel", project_award_type_award_path(transfer.project, transfer.award_type, transfer), method: :delete, class: 'transfers-table__transfer__button__history' %>
      <% end %>
    <% else %>
      –
    <% end %>
  </div>

  <div class="transfers-table__transfer__transferred_at">
    <label>transferred at</label>

    <% if transfer.paid? && transfer.transferred_at %>
      <%= transfer.transferred_at.strftime("%b %e, %Y") %>
    <% else %>
      –
    <% end %>
  </div>
</div>
